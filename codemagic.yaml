workflows:
  android-workflow:
    name: Android Workflow
    instance_type: mac_mini
    max_build_duration: 120
    environment:
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmlVSm1RWGhYOTJkbm4xU1N5N255aTBiWlQ4UjNNYjFKT0hPT1NSaWJCSGp5NTlyUjlwS2ZCU1NldUp6dzE0NHRjRDl3Vk5HRHNqX1UtcjFfZmR5UGpWZ3lUejB3czFVZjZFeUhlTVBVcjdLcmNtemxQWEdrWUlZNndSUkF1QnFJV1QwNDhJTXRBTnNVQUFrX2hsX1dBRTNtUDdSOHlUQ2cxTmM3T2ZhaDlSS2stdkNsRFg2VW0zNDZRWmlOSndHZy01Z18zMmhTR3VXR0tKTUpVT19TM1pZTy1iQVpiakVmNW5UUnpkdWdwOC1QeVZkWk5oeGNscURuMGIwbkppYWEtZGdzdjY5R3VtUXZDNkE3ek1rdDZybkxsV1pZZDBKOHVHZjVmQmJYRU9XcGR1dlRKSnhxMFhVbHdiajB0NVZOVDRNN0VMQkNOcmRXcFJNX2pLTmxLbjNGTzUyZ1FjOEJzQ1BJQ3Bzd1EwMzREeUFSUlJwOEdRRFN3Tm1YVE1maFY5Ulp4dnBjb2FTX3ZybHRKcGo5cEdkS1VpSmxIajhQbUtBTWNjODZST0JYclNsNFJGQWhnb3N6QTNJSlNVVDN4NmJjeVVqdkh0QWYwNWt0alBBTHJQMVYxc0RvcDBHLXd0eE1LcEhFUldGMGZqNTZBWWQybklWYXpaT0pEOXk5Z0pJaDhLVnFXOUVEYlBKSEUxYXlOaU51WVprNklpc1JZcllrUG5kaFZqM2Nvay1aT1MyQlJCZDNUZ2RoZDU2SENXRXFVV19HaVZsODQ5UU41R01pUnBYaTI1S3Jjazhnc3FwQkxjUVNjUTAtbHJTM0EzTXl3Wm5Wa1VMT3RnUnVmUGZMdGx3WUpUY0JseVg5cVFCODlZTE1NTEkxUW1QMThDcXBUa214bWVBUDlHcVVFWHZLTUN3SFV2V2xmbmRaNFlPSkNmM20tZGRMTDVQVE8tLVB1YVFXRXBwX2ZpWGZ4NmhmQkVvX1Y1TjRhWmdaT1FnbGd4Mmo0djNwS0hHRnM3bTNSVEx0RzdUajJMMlg0bUY4YWNwb21pUTE5dmw4V3h6RHVZQTlTNEF0NE9PU0FvamdQWGNwUGg4RmRpZWFZeTZ4S0UxQ1hUNlRjNk5nN29LUU5pV2haaVg5Y3FnLW52bGNZcmlYTDl5cjRQZmgxUGw1RFhvTkpWX2NNMUp3dmJOSFpzZWl3czF2Y2hqTFVWaUZjVExsRU1FaW85TDRFd1dkVWdFWWNSb3hGV2NEU1QwN3huelhfUGdHallDbTZ4VF9qR05RbGEzTEJRVVFTZlNnb3RuWERvUldObm9OQThXZGhlVDJaSHlhU3pGcms5T1BqLV82SjJMQVVwdFY1enFUdm02aVZWOHdpZGFkTUVUTTRTaXYxaXVuclE5cVBTMlF6WjNjSmNiQlRMc3hwaGI3d0pzTWZURlJoX29ob1g2dFcyaTBkRUR2VHNXR0VrNTY0ZVhLTVBZZkZhSzdXbTZsMUpEeGZTcFBVWDlOc2ZKcXpTOTBESkExcUdtOUdKbHc1Sm9QMkN6bk1PNVNBWVFick1JVXc5STRrc3lwVE50Wi04Umt4WGpQdGh6YUVXWS16X01jLUEzQkkzY2hLTkhiNG5oS2VjdjlkVTR4UlVnNlZLT3ZrV2Q4dzZQU2Q5d2lCVDVkd0YxckhKWWhxbVloRUIwNHBTU3pFcVJIUlZoUmg1WUZwNHk2V2lJclBDc2JobXpOWUgtZEZXZ2N1NHlkNUlqaFYzb1VuVlJHb21fQS0tWkFDcW1KOU1ONndEWjJVZ2tZSzU3ODRpRGFqMERQNHZxOFAzaDQyZkNMMUttYmY5RGs5MWswMXB4YmYzdjBuNDM2b1g2TENjRGZzYkRvcVhoSDZ3aTBSTFB1Q3FDNFZVM2I0UmFQcFVBNGpBWkEtNmxrMlJHdFRsWGw0MnJXRjI3MHdVYW5SaFk1djl0UlJrLU03Z1lsa25xSnNBTHlxd0FmQkRDRFBtVjBDbGF5WFFEU05HSGtTZEp3dlRjbTB4R3ZKX09hbzZBWjUwZjNaOEg2ZEc5bXRZU1otUDBwMmFwZmR0V2JQcHJvOWtxTzVxeFVEWWJfV2l3MElyRldOMngxWGhKWjhkaXZuaUx1NkVvZ0FPVDRzRGJfNWozbVh2OEVQajAwbkJwSU1YYlpsVGxaZDh2T011TlpTRG5NbjVPUUFFbFVMOGNIVU5wTWlUek1OOHZvX2pNY2lqTEhZckRSVEhGN1ZhMk5uTHZKMGp2dDFGSGE2UjlIYmtCcGw1aUZRVU5qSm9wUXZtLXhRcmVzMU9VZHlWcThMcVZRYW83R003ZW9IYk1VeXVTVnNDS3pKUkZvTXN3bUgwQXpGb3VNMTRFa2NBTTFoWkdVa2lIbmRra1U4Q0phdFg0N2p4VFA0aWxMRk8tM2pDRm1BTDdOX3NiVmJPbFlobmRiUUhuaDQ2NUVWZ19XeXJvS19YaVRNeW5IeHIxNklIVW9UekVwV2xKWndqQWVKVkxFd08tRzNEWE5NSzVZTHZhbkxTYlVRSTZiXzEwUVozMW80VkMtdE1qRURZSEExajVCSVFQS1c0LU5ubGcyRnB1bm84UGRRTUxnS3B6R1ZVeGZYUVdzTzB5eFRwX0FqcWZFX0IxMURPZWdhWEpMdnFiYjJnRjNjYjVRZWFoS2IzRW1ZUC1SY0V1d1p5UVA5WWM1cS1UWVliaWJVRkx1d0Viell4WlR1ZExXS3ctSXhkdDJQZmRKRXRzS1V3TmZPZjQ3R2p0b0hlZENQSW5mME93eGloMVhoUmctVm5xMFJ6dUVaWHhEaFZJMzBheThoZ2o3NHBmZkpCaXdvbFhUb2dFOWNGR2kyNkVEN2g5Ylh4ZGl1enQyTE9ESkFSNGd1MFVuMDlKZ2lYdmNLcVBEbU1QMER2OHBDYkRTZ19Fc1ZxVHpSazBVYUdNZU1HNHRRakZjVWo4R2hqdXA2YW1nc1dmbll3TzFhMlJ4YXFKalNXUnVadHZlZTNPd0FPY0VrSUV6THhnTTZMdkllLWtlZGxEQVVxUHAtSlpGOTg1QjZvZERyR2dORGs2YW16bFhhN1BsMDRVR011Mm4taXdPYjROUEJXaE4tdGVMdHUzd1BsdmVnR1ZVSDJJVUVDOFU3UXNORTU5X0Q1ekIybmR6b2lYdVFoVWs2bDFzLXIwODN2bDlBUmxqNm56M1lfT2pPV09ncnJQVG5URDR5SVBYVVEtQjI3YkZjQjZjSHUtZTM3bUFOXzIzUTNoc2JzUDlCRWFHUDhwLVRtcUlORDlrSXdGUm94NG9PQmVwNDFrVDQ1d2l6U0syMGg4WlFCRE9hWjYzWWtlQm5vWEQ0N2F5Y1NuLXk1SlBOZ2ZQaXZpckMtRXhPQXVXaW13VGM0SzRlYTFOV1ltTzNCTER1Q2UtT0JVY1lUaEEtb1YyTVJ1Ym1tcDZVS2JIZ0V3dko4WXhWdENXZmROSWJydHdjaDF3cVZYUElUbUxVYy1KQTJnTktXd0NWdnRqYTdkM1hCLUpTWVY1M21adzJyeGVhOURKOC12OUpKRmhyYlJOek51UlhmVm1WdXlBMzgwZl8xd25SMlA0c1FXdHZjYWVLOGxFVTlMLThQQW1oRHZNVGRqVUViV2Z0clg0bVdrTUg5QTdrYmVzMGVIQmpHVU5PczU2aTctQ3NGYWJLNmJyMkZyRGVURUl2X3dLbWVkMmFvMVFyakZYdXZwNlU5WFMtbGJBZ1dXeG5GeVl4RGJsMW5jNTlxRmFFRjN5NEdZSE43cUhQQXVQdHdWS29SbXFzMkhJVHhtejZ1Q3MzU0xPOEFrcTE0OGJkZnExckhveTYtdTRxQ1VndkZuVDBOamVBMUxUbC1veU9lOThhN182cUtHZTBrLUl1LThpOUR1a1RQRUVNUUE5LS0zNDltcEI1Y3p3MjNxVElTWnN5TldlTXpuM0dKVDJFbmYyc1E4cTJiVk5xbVA2M2sxY2l2SmhPYWlEWnNTelJiRzl5ZzhuQ3ZZcnFZTjQ1V3BPekhRYS1RQlJ2bExEcDJhSVNXeHctQjVuNktKSTZSbEZoRTdTTm8zcndmTGptMkxEUExkSl9pM0JkUS1FMHdYcy1US01TR29GTGdvemlYeG41UXJKdnMwTDdhMWM1R096TDkxU3I4Rkt5T2NtYmZhVGthcXhwUXo4QXgtSnNnUFdlZ0JYa3UwbGQ0QTZhUlN5c1RMdDV2RUFEN2FfTmZjdzRrUUVZWjRDdjM3WTRtTEJLeDV6Z0Q1bE9YTW5zRUV1RFZsLUpseGhHM05kRWlCRmtoeWRtTmxTTzlnSE83UE9kSEVscHFkYTRYdEhMT0VoalRaUHNCRE5wTGwxMGplOTFZRDlXb0lTbDU1eEI0RWRxS1pBTTlkUmtWUTI3VE5WOU81WkhOcnRqdjFNeUFSeTNYNzJCVF9pU3ctSjJzLURLRVRDM0lrQWpvS3NYa1NmdEc0RHVjcE5hOXNDSnZLZ0w2MlJPdFhSR3lCaWI2U3dDLTVmUG1FUUZYSjAyanUyaldtX21nSWMycmZ5cjFEaXZfbDVzWWJyY2stamh2WTE2aUs1NDNWY2FpUi1mRklmeUY4a2lDWDhmeTl4UGJxTDF1VTNYN3pVVC1NdVdBMGg3elVuR1I1eEJUNkRTc3ZUQ1l4VkhDSGdrcURyQmlIR2dIcG9Cb2Q1eTFJNEcxanloTzJ5Nl85aTlHQjVQUnB3a2c4QjdXWVZKTFAyamNUQlRuU1l5QXVwM296bTdfWVRVRjQ3ZGRxaHRKTmN6aXRMR1FvOTJKeEhxQVd0Zk5mZy1qdzYzcFFRU2Z2MnhyQzZ2T2JmdUk3blZtTkVjWVFHdTZ3S0JYVXY5cHhaUVNSRWlQenZnWjhBa0JDdkZiZ1c2UWsyZ00wekVDaGdXVEFSWHZFRzU3bDlQYXJTekN2SWcxWHdYOGMtdzhITkEyek93cWVfOFdxZWxMOVV3X0pxV1I2dVhsY2d5OUNPbnhUWlF3OVFaZFkzSjliQnZ6TmdyV3R3RTJ6bDJXTFVLYzREYU5ZNWo5T2NISWlTWjdpM2o0WmFZRkRmbmpSUTVCQ3hCTTdBOFVoU1EtdGt0REp3WVVqalc0dlVna0E3MzN1eTFoYVZQdjh5Q0dyUTBtTmM0RU05SzFxTWR6WjBlX2Q0YmVDN2RlMC1Pb2J6MmY0OWM2RlhfR2dzRmtoek1meW1NQzE5Y3VMVU1pTXoyXzBqNTRrLTYxMk1mVXpKam5FMEVKY3g0dEpvRC1Ba1pPNk1TaFpkWTZZRmExVGduTXZVcmFsRzAtZ2Joak5BVXJQSEctU3l1TXh4eFRQV0Vuc25udkN5WE42MUtHLUlZ)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmlVSm1RMWxLY2ZONENyOEFsVDkxVDdjLWJLd1RKaFBHTmtRdE9WdXZmSnRxOGwtU2l6OGZoUXVzd1l2bVh2cS1LQmtuczVEcnNXcUhiUEJyVEZrOVpzbl8yeTdZNURxNnIzT1hpTHlfZW5pVlo1SUU9)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmlVSm1RVFhzb2xZOThXcHpQekFsSEE0QUkwcDN0YnhVTE9jVmNGSzk5Mldubl9pWXVpV2hXTDZRQzltaVNtUE1FWktIUEVqY2k4S3VlNDZhaUpFMHlHLUhRV0s0WGx4Sy1LcGFjRzFWclp0MEgwY2s9)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmlVSm1RSlVvY0I1MVg2czdFWEZYSHg2d3BZa3o1Z2RjYXVGa0Q0Q2NZT1FudUljbG9rYmlGZTA1ZktfelpQcDJSakV1RXB0ZlUzcUphMWRsam96NHJlSnFGS3c9PQ==)
      groups:
        - keystore_credentials
        - FIREBASE_TOKEN
        - other
      flutter: stable
      xcode: latest
      cocoapods: default
    scripts:
      - name: set up key.properties
        script: |
          echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_PASSWORD
          keyAlias=$FCI_KEY_ALIAS
          storeFile=/tmp/keystore.keystore
          EOF
      - name: set up local properties
        script: |
          echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
          flutter packages pub get
          flutter build apk --release
      - name: Get Flutter packages
        script: |
          cd . && flutter packages pub get
      - name: Build Android
        script: |
              echo $CM_KEYSTORE | base64 --decode > $CM_KEYSTORE_PATH
              cd android && ./gradlew assembleRelease
      - name: Build APK with Flutter
        script: |
          cd . && flutter build apk --release --build-name=1.0.5 --build-number=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME")))
    artifacts:
      - build/**/outputs/**/*.apk
    publishing:
      email:
        recipients:
          - kevin@nevercode.io
          - medoleader91@gmail.com
        notify:
          success: true
          failure: false
      firebase:
        firebase_token: $FIREBASE_TOKEN
        android:
          app_id: 1:1033037829777:android:98359919d7630e78bf1130
          groups:
            - androidTesters

